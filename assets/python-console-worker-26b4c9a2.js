(function(){"use strict";/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const C=Symbol("Comlink.proxy"),z=Symbol("Comlink.endpoint"),I=Symbol("Comlink.releaseProxy"),x=Symbol("Comlink.finalizer"),_=Symbol("Comlink.thrown"),A=e=>typeof e=="object"&&e!==null||typeof e=="function",j={canHandle:e=>A(e)&&e[C],serialize(e){const{port1:n,port2:t}=new MessageChannel;return P(e,n),[t,[t]]},deserialize(e){return e.start(),V(e)}},D={canHandle:e=>A(e)&&_ in e,serialize({value:e}){let n;return e instanceof Error?n={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:n={isError:!1,value:e},[n,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},R=new Map([["proxy",j],["throw",D]]);function H(e,n){for(const t of e)if(n===t||t==="*"||t instanceof RegExp&&t.test(n))return!0;return!1}function P(e,n=globalThis,t=["*"]){n.addEventListener("message",function a(i){if(!i||!i.data)return;if(!H(t,i.origin)){console.warn(`Invalid origin '${i.origin}' for comlink proxy`);return}const{id:r,type:s,path:l}=Object.assign({path:[]},i.data),u=(i.data.argumentList||[]).map(h);let o;try{const c=l.slice(0,-1).reduce((d,y)=>d[y],e),f=l.reduce((d,y)=>d[y],e);switch(s){case"GET":o=f;break;case"SET":c[l.slice(-1)[0]]=h(i.data.value),o=!0;break;case"APPLY":o=f.apply(c,u);break;case"CONSTRUCT":{const d=new f(...u);o=X(d)}break;case"ENDPOINT":{const{port1:d,port2:y}=new MessageChannel;P(e,y),o=q(d,[d])}break;case"RELEASE":o=void 0;break;default:return}}catch(c){o={value:c,[_]:0}}Promise.resolve(o).catch(c=>({value:c,[_]:0})).then(c=>{const[f,d]=v(c);n.postMessage(Object.assign(Object.assign({},f),{id:r}),d),s==="RELEASE"&&(n.removeEventListener("message",a),N(n),x in e&&typeof e[x]=="function"&&e[x]())}).catch(c=>{const[f,d]=v({value:new TypeError("Unserializable return value"),[_]:0});n.postMessage(Object.assign(Object.assign({},f),{id:r}),d)})}),n.start&&n.start()}function U(e){return e.constructor.name==="MessagePort"}function N(e){U(e)&&e.close()}function V(e,n){return k(e,[],n)}function w(e){if(e)throw new Error("Proxy has been released and is not useable")}function T(e){return g(e,{type:"RELEASE"}).then(()=>{N(e)})}const b=new WeakMap,E="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const n=(b.get(e)||0)-1;b.set(e,n),n===0&&T(e)});function W(e,n){const t=(b.get(n)||0)+1;b.set(n,t),E&&E.register(e,n,e)}function G(e){E&&E.unregister(e)}function k(e,n=[],t=function(){}){let a=!1;const i=new Proxy(t,{get(r,s){if(w(a),s===I)return()=>{G(i),T(e),a=!0};if(s==="then"){if(n.length===0)return{then:()=>i};const l=g(e,{type:"GET",path:n.map(u=>u.toString())}).then(h);return l.then.bind(l)}return k(e,[...n,s])},set(r,s,l){w(a);const[u,o]=v(l);return g(e,{type:"SET",path:[...n,s].map(c=>c.toString()),value:u},o).then(h)},apply(r,s,l){w(a);const u=n[n.length-1];if(u===z)return g(e,{type:"ENDPOINT"}).then(h);if(u==="bind")return k(e,n.slice(0,-1));const[o,c]=M(l);return g(e,{type:"APPLY",path:n.map(f=>f.toString()),argumentList:o},c).then(h)},construct(r,s){w(a);const[l,u]=M(s);return g(e,{type:"CONSTRUCT",path:n.map(o=>o.toString()),argumentList:l},u).then(h)}});return W(i,e),i}function B(e){return Array.prototype.concat.apply([],e)}function M(e){const n=e.map(v);return[n.map(t=>t[0]),B(n.map(t=>t[1]))]}const F=new WeakMap;function q(e,n){return F.set(e,n),e}function X(e){return Object.assign(e,{[C]:!0})}function v(e){for(const[n,t]of R)if(t.canHandle(e)){const[a,i]=t.serialize(e);return[{type:"HANDLER",name:n,value:a},i]}return[{type:"RAW",value:e},F.get(e)||[]]}function h(e){switch(e.type){case"HANDLER":return R.get(e.name).deserialize(e.value);case"RAW":return e.value}}function g(e,n,t){return new Promise(a=>{const i=Y();e.addEventListener("message",function r(s){!s.data||!s.data.id||s.data.id!==i||(e.removeEventListener("message",r),a(s.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:i},n),t)})}function Y(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var L=function(e,n,t,a){function i(r){return r instanceof t?r:new t(function(s){s(r)})}return new(t||(t=Promise))(function(r,s){function l(c){try{o(a.next(c))}catch(f){s(f)}}function u(c){try{o(a.throw(c))}catch(f){s(f)}}function o(c){c.done?r(c.value):i(c.value).then(l,u)}o((a=a.apply(e,n||[])).next())})},O=function(e,n){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},a,i,r,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(o){return function(c){return u([o,c])}}function u(o){if(a)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(t=0)),t;)try{if(a=1,i&&(r=o[0]&2?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[o[0]&2,r.value]),o[0]){case 0:case 1:r=o;break;case 4:return t.label++,{value:o[1],done:!1};case 5:t.label++,i=o[1],o=[0];continue;case 7:o=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(o[0]===6||o[0]===2)){t=0;continue}if(o[0]===3&&(!r||o[1]>r[0]&&o[1]<r[3])){t.label=o[1];break}if(o[0]===6&&t.label<r[1]){t.label=r[1],r=o;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(o);break}r[2]&&t.ops.pop(),t.trys.pop();continue}o=n.call(e,t)}catch(c){o=[6,c],i=0}finally{a=r=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}},J=function(e){var n=typeof Symbol=="function"&&Symbol.iterator,t=n&&e[n],a=0;if(t)return t.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},$=function(e,n){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var a=t.call(e),i,r=[],s;try{for(;(n===void 0||n-- >0)&&!(i=a.next()).done;)r.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(s)throw s.error}}return r};importScripts("https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"),self.location.hostname!=="localhost"&&(console.log=function(){},console.error=function(){});var S,K={getInput:function(e,n){var t=new XMLHttpRequest;return t.open("GET","/react-py-get-input/?id=".concat(e,"&prompt=").concat(n),!1),t.send(null),t.responseText}},Q={init:function(e,n,t){return L(this,void 0,void 0,function(){var a,i,r,s,l,u,o,c,f,d,y,p;return O(this,function(m){switch(m.label){case 0:return a=self,[4,self.loadPyodide({})];case 1:return a.pyodide=m.sent(),[4,self.pyodide.loadPackage(["pyodide-http"])];case 2:return m.sent(),t[0].length>0?[4,self.pyodide.loadPackage(t[0])]:[3,4];case 3:m.sent(),m.label=4;case 4:return t[1].length>0?[4,self.pyodide.loadPackage(["micropip"])]:[3,7];case 5:return m.sent(),i=self.pyodide.pyimport("micropip"),[4,i.install(t[1])];case 6:m.sent(),m.label=7;case 7:return r=self.crypto.randomUUID(),s=self.pyodide.version,self.pyodide.registerJsModule("react_py",K),l=self.pyodide.globals.get("dict")(),u=`
import pyodide_http
pyodide_http.patch_all()

import sys
from pyodide.ffi import to_js
from pyodide.console import PyodideConsole, repr_shorten, BANNER
import __main__
BANNER = "Welcome to the Pyodide terminal emulator üêç\\n" + BANNER
pyconsole = PyodideConsole(__main__.__dict__)
import builtins
async def await_fut(fut):
  res = await fut
  if res is not None:
    builtins._ = res
  return to_js([res], depth=1)
def clear_console():
  pyconsole.buffer = []
`,[4,self.pyodide.runPythonAsync(u,{globals:l})];case 8:return m.sent(),o=`
import sys, builtins
import react_py
__prompt_str__ = ""
def get_input(prompt=""):
    global __prompt_str__
    __prompt_str__ = prompt
    print(prompt, end="")
    s = react_py.getInput("`.concat(r,`", prompt)
    print()
    return s
builtins.input = get_input
sys.stdin.readline = lambda: react_py.getInput("`).concat(r,`", __prompt_str__)
`),[4,self.pyodide.runPythonAsync(o,{globals:l})];case 9:return m.sent(),c=l.get("repr_shorten"),f=l.get("BANNER"),d=l.get("await_fut"),y=l.get("pyconsole"),p=l.get("clear_console"),l.destroy(),y.stdout_callback=e,S={reprShorten:c,awaitFut:d,pyconsole:y,clearConsole:p},n({id:r,version:s,banner:f}),[2]}})})},run:function(e){return L(this,void 0,void 0,function(){var n,t,a,i,r,s,l,u,o,c,f,d,y;return O(this,function(p){switch(p.label){case 0:if(!S)throw new Error("Console has not been initialised");if(e===void 0)throw new Error("No code to push");p.label=1;case 1:p.trys.push([1,9,10,11]),t=J(e.split(`
`)),a=t.next(),p.label=2;case 2:if(a.done)return[3,8];i=a.value,r=S.pyconsole.push(i),n=r.syntax_check,s=S.awaitFut(r),p.label=3;case 3:return p.trys.push([3,5,6,7]),[4,s];case 4:return l=$.apply(void 0,[p.sent(),1]),u=l[0],self.pyodide.isPyProxy(u)&&u.destroy(),[3,7];case 5:if(o=p.sent(),o.constructor.name==="PythonError")return c=r.formatted_error||o.message,[2,{state:n,error:c.trimEnd()}];throw o;case 6:return r.destroy(),s.destroy(),[7];case 7:return a=t.next(),[3,2];case 8:return[3,11];case 9:return f=p.sent(),d={error:f},[3,11];case 10:try{a&&!a.done&&(y=t.return)&&y.call(t)}finally{if(d)throw d.error}return[7];case 11:return[2,{state:n}]}})})},readFile:function(e){return self.pyodide.FS.readFile(e,{encoding:"utf8"})},writeFile:function(e,n){return self.pyodide.FS.writeFile(e,n,{encoding:"utf8"})},mkdir:function(e){self.pyodide.FS.mkdir(e)},rmdir:function(e){self.pyodide.FS.rmdir(e)}};P(Q)})();
